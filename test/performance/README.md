# Performance report

The policies in the dataset are generated by [`generatePolicies`](generatePolicies.js), they have the following format:

```
{
  Version: '2106-10-17',
  Statement: [{
    Effect: effect || 'Allow',
    Action: [
      'foo:bar:clone',
      'foo:bar:delete',
      'foo:bar:list',
      'foo:bar:read',
      'foo:bar:publish'],
    Resource: [
      `resources/thing${i}/*`,
      `resources/thing${i+1}/*`,
      `resources/thing${i+2}/*`,
      `resources/thing${i+3}/*`,
      `resources/thing${i+4}/*`,
      `resources/thing${i+5}/*`,
      `resources/thing${i+6}/*`,
      `resources/thing${i+7}/*`,
      `resources/thing${i+8}/*`,
    ]
  }]
}
```

Running `iam.process` for a resource that does not exists on incrisingly higher sets of policies gives the following results

```
iam-js 10: 4.472ms
iam-js 10 again: 1.093ms
iam-js 100: 4.078ms
iam-js 100 again: 3.828ms
iam-js 1000: 53.642ms
iam-js 1000 again: 19.131ms
iam-js 10000: 337.063ms
iam-js 10000 again: 220.266ms
iam-js 100000: 2728.772ms
iam-js 100000 again: 1408.317ms
```

Running the same dataset with PBAC gives the following results (basically the same as `iam-js`)

```
pbac 10: 4.571ms
pbac 10 again: 1.801ms
pbac 100: 8.355ms
pbac 100 again: 4.210ms
pbac 1000: 47.796ms
pbac 1000 again: 26.098ms
pbac 10000: 340.337ms
pbac 10000 again: 155.274ms
pbac 100000: 2826.905ms
pbac 100000 again: 1494.828ms
```

Running for a specific resource (in the last part of the data set) that has a `Deny` gives the following results

```
iam-js 'Deny' 10: 3.362ms
iam-js 'Deny' 10 again: 0.380ms
iam-js 'Deny' 100: 7.268ms
iam-js 'Deny' 100 again: 3.835ms
iam-js 'Deny' 1000: 43.789ms
iam-js 'Deny' 1000 again: 25.337ms
iam-js 'Deny' 10000: 261.369ms
iam-js 'Deny' 10000 again: 183.352ms
iam-js 'Deny' 100000: 2247.195ms
iam-js 'Deny' 100000 again: 1155.548ms
```

Reducing the number of actions and resource for each policy gives slightly better results

```
// policy format
{
  Version: '2106-10-17',
  Statement: [{
    Effect: effect || 'Allow',
    Action: [
      'foo:bar:clone'
    ],
    Resource: [
      `resources/thing${i}/*`
    ]
  }]
}
```

`iam-js.process`:

```
iam-js 10: 3.544ms
iam-js 10 again: 0.253ms
iam-js 100: 3.989ms
iam-js 100 again: 4.632ms
iam-js 1000: 27.757ms
iam-js 1000 again: 5.075ms
iam-js 10000: 202.505ms
iam-js 10000 again: 46.422ms
iam-js 100000: 1740.561ms
iam-js 100000 again: 588.274ms
```

`pbac.evaluate`:

```
pbac 10: 4.482ms
pbac 10 again: 0.301ms
pbac 100: 2.964ms
pbac 100 again: 2.685ms
pbac 1000: 12.637ms
pbac 1000 again: 4.338ms
pbac 10000: 181.672ms
pbac 10000 again: 36.008ms
pbac 100000: 1476.395ms
pbac 100000 again: 495.034ms
```

`iam-js.process` with `Deny`:
```
iam-js 'Deny' 10: 3.910ms
iam-js 'Deny' 10 again: 0.458ms
iam-js 'Deny' 100: 2.707ms
iam-js 'Deny' 100 again: 3.845ms
iam-js 'Deny' 1000: 16.162ms
iam-js 'Deny' 1000 again: 14.357ms
iam-js 'Deny' 10000: 166.896ms
iam-js 'Deny' 10000 again: 55.097ms
iam-js 'Deny' 100000: 1521.374ms
iam-js 'Deny' 100000 again: 474.812ms
```


Notes:

* The aim-js and pbac object are all created with options `{validateSchema: false, validatePolicies: false}`

* All results show and exponential trend

* Running twice the same test highlights that the second time the operation is faster

```
iam-js 10: 4.472ms
iam-js 10 again: 1.093ms


pbac 10: 4.571ms
pbac 10 again: 1.801ms


iam-js 'Deny' 10: 3.362ms
iam-js 'Deny' 10 again: 0.380ms
```

(In both tests we create a new `iam-js`/`pbac` object with the same set of policies)
